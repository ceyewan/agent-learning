# A2A 数学代理系统使用指南

这是一个基于 Agent-to-Agent (A2A) 架构的数学计算系统演示。

## 系统组件

1. **三个数学代理**:
   - `sine_agent.py` - 计算正弦值 (端口 4737)
   - `cosine_agent.py` - 计算余弦值 (端口 4738)  
   - `tangent_agent.py` - 计算正切值 (端口 4739)

2. **客户端**:
   - `client.py` - 智能路由客户端，使用 LLM 来决定查询应该路由到哪个代理

3. **工具脚本**:
   - `start_agents.py` - 一键启动所有代理服务器

## 使用步骤

### 1. 配置环境变量
确保 `.env` 文件中包含有效的 QWEN_API_KEY：
```
QWEN_API_KEY=your_api_key_here
```

### 2. 启动代理服务器

#### 方法一：使用启动脚本（推荐）
```bash
python start_agents.py
```

#### 方法二：手动启动每个代理
```bash
# 在三个不同的终端窗口中运行：
python sine_agent.py      # 端口 4737
python cosine_agent.py    # 端口 4738  
python tangent_agent.py   # 端口 4739
```

### 3. 运行客户端
```bash
python client.py
```

## 预期输出

客户端会自动测试以下查询：
- "60 度的正切值是多少？" → 应该路由到 Tangent 代理
- "计算 30 度的正弦值" → 应该路由到 Sine 代理
- "45 度的余弦值是多少？" → 应该路由到 Cosine 代理

## 关键修复

1. **API Key 格式修复**: 
   - 原: `"Bearer {QWEN_API_KEY}"` 
   - 修复为: `f"Bearer {QWEN_API_KEY}"`

2. **错误处理**: 添加了连接性测试和详细的错误信息

3. **调试信息**: 包含详细的路由和调用信息

4. **多端点支持**: 客户端会尝试多个API端点来调用代理

## 故障排除

如果遇到问题：

1. **路由错误**: 检查 QWEN_API_KEY 是否正确设置
2. **连接错误**: 确保所有代理服务器都在运行
3. **API 错误**: 检查通义千问 API 配额和网络连接

## 测试

运行客户端后，你应该看到：
- ✓ 代理连接性测试结果
- 🤖 智能路由决策（哪个查询路由到哪个代理）
- 📋 每个代理的计算结果

这个演示展示了 A2A 系统如何使用 LLM 进行智能路由，将不同类型的数学查询自动分发到相应的专业代理。
